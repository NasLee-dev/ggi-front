# 베이스 이미지
FROM node:18-alpine AS builder

# 작업 디렉토리 설정
WORKDIR /app

# 패키지 파일들을 복사 -- 
COPY package.json yarn.lock ./

# 환경변수 설정 (ARG를 사용하여 .env에 있는 변수를 설정)
ARG NEXT_PUBLIC_NAVER_MAP_API
ARG NEXT_PUBLIC_NAVER_MAP_SECRET
ARG NEXT_PUBLIC_DAWUL_API_KEY
ARG NEXT_PUBLIC_NATIONAL_API_KEY
ARG NEXT_PUBLIC_KAKAO_URL
ARG NEXT_PUBLIC_KAKAO_API_KEY
ARG NEXT_PUBLIC_GONG_GONG_API_KEY
ARG NEXT_PUBLIC_ADDR_API_KEY
ARG NEXT_PUBLIC_GONGGONG_KEY
ARG NEXT_PUBLIC_KAKAO_JS_KEY

# 환경 변수를 컨테이너 환경으로 설정
ENV NEXT_PUBLIC_NAVER_MAP_API=${NEXT_PUBLIC_NAVER_MAP_API}
ENV NEXT_PUBLIC_NAVER_MAP_SECRET=${NEXT_PUBLIC_NAVER_MAP_SECRET}
ENV NEXT_PUBLIC_DAWUL_API_KEY=${NEXT_PUBLIC_DAWUL_API_KEY}
ENV NEXT_PUBLIC_NATIONAL_API_KEY=${NEXT_PUBLIC_NATIONAL_API_KEY}
ENV NEXT_PUBLIC_KAKAO_URL=${NEXT_PUBLIC_KAKAO_URL}
ENV NEXT_PUBLIC_KAKAO_API_KEY=${NEXT_PUBLIC_KAKAO_API_KEY}
ENV NEXT_PUBLIC_GONG_GONG_API_KEY=${NEXT_PUBLIC_GONG_GONG_API_KEY}
ENV NEXT_PUBLIC_ADDR_API_KEY=${NEXT_PUBLIC_ADDR_API_KEY}
ENV NEXT_PUBLIC_GONGGONG_KEY=${NEXT_PUBLIC_GONGGONG_KEY}
ENV NEXT_PUBLIC_KAKAO_JS_KEY=${NEXT_PUBLIC_KAKAO_JS_KEY}

# 종속성 설치
RUN yarn install

# 나머지 파일들 복사
COPY . .

WORKDIR /app/services/ggi-web

RUN yarn workspace data-web install
RUN yarn workspace data-web build

# 포트 노출
EXPOSE 4000

# 애플리케이션 시작 명령
CMD ["yarn", "workspace", "data-web", "start"]
